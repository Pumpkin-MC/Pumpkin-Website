<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' https://avatars.githubusercontent.com data:; connect-src 'self' https://api.github.com https://www.google-analytics.com; frame-ancestors 'none'"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()" />
    <title>Download Pumpkin - Blazingly Fast Minecraft Server</title>
    <meta
      name="description"
      content="Download the latest release of Pumpkin, the fastest Minecraft server."
    />
    <link rel="icon" type="image/svg+xml" href="../assets/icon.svg" />
    <link rel="stylesheet" href="../style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha384-rWj9FmWWt3OMqd9vBkWRhFavvVUYalYqGPoMdL1brs/qvvqz88gvLShYa4hKNyqb"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <header>
      <a href="/" class="logo">
        <img src="../assets/icon.svg" alt="Pumpkin" />
        <span>pumpkin</span>
      </a>
      <nav>
        <a href="/">Home</a>
        <a href="https://docs.pumpkinmc.org/">Docs</a>
        <a href="/developers/">Developers</a>
        <a href="/contributors/">Contributors</a>
      </nav>
      <div class="header-icons">
        <a
          href="https://github.com/Pumpkin-MC/Pumpkin"
          class="icon-btn"
          title="GitHub"
        >
          <i class="fa-brands fa-github"></i>
        </a>
        <a
          href="https://discord.com/invite/wT8XjrjKkf"
          class="icon-btn"
          title="Discord"
        >
          <i class="fa-brands fa-discord"></i>
        </a>
        <a
          href="https://github.com/sponsors/Snowiiii"
          class="sponsor-btn"
          title="Sponsor"
        >
          <i class="fa-solid fa-heart"></i>
        </a>
        <a href="/download/" class="download-btn">Download</a>
      </div>
    </header>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-QK7NXQQ2ZP"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-QK7NXQQ2ZP");
    </script>

    <main>
      <section class="download-hero">
        <h1 class="section-title">
          <span class="highlight">Download</span> Pumpkin
        </h1>
        <p>
          Self-contained executable. No Java required. Just download, run, and
          play.
        </p>

        <!-- Auto-detect OS download -->
        <div class="auto-download">
          <a id="auto-download-btn" href="#" class="btn btn-primary btn-xl">
            <i id="auto-download-icon" class="fab fa-windows"></i>
            <span id="auto-download-text">Download for Windows</span>
            <i class="fa-solid fa-download"></i>
          </a>
          <p class="auto-download-meta">
            <span id="auto-download-arch">x86-64</span> &bull;
            <span id="auto-download-build">Loading...</span>
          </p>
          <p class="auto-download-alt">
            Not your OS? <a href="#all-downloads">See all downloads below</a>
          </p>
        </div>

        <h2 id="all-downloads" class="downloads-heading">All Platforms</h2>

        <div class="download-grid">
          <!-- Windows -->
          <div class="download-card">
            <h3><i class="fab fa-windows"></i> Windows</h3>
            <div class="download-options">
              <a
                href="https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-X64-Windows.exe"
                class="download-option"
              >
                <div class="arch">
                  <span>x86-64 (Intel/AMD)</span>
                </div>
                <i class="fa-solid fa-download"></i>
              </a>
              <a
                href="https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-ARM64-Windows.exe"
                class="download-option"
              >
                <div class="arch">
                  <span>ARM64</span>
                </div>
                <i class="fa-solid fa-download"></i>
              </a>
            </div>
          </div>

          <!-- Linux -->
          <div class="download-card">
            <h3><i class="fab fa-linux"></i> Linux</h3>
            <div class="download-options">
              <a
                href="https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-X64-Linux"
                class="download-option"
              >
                <div class="arch">
                  <span>x86-64 (Intel/AMD)</span>
                </div>
                <i class="fa-solid fa-download"></i>
              </a>
              <a
                href="https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-ARM64-Linux"
                class="download-option"
              >
                <div class="arch">
                  <span>ARM64</span>
                </div>
                <i class="fa-solid fa-download"></i>
              </a>
            </div>
          </div>

          <!-- macOS -->
          <div class="download-card">
            <h3><i class="fab fa-apple"></i> macOS</h3>
            <div class="download-options">
              <a
                href="https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-ARM64-macOS"
                class="download-option"
              >
                <div class="arch">
                  <span>ARM64</span>
                  <span class="badge">Apple Silicon</span>
                </div>
                <i class="fa-solid fa-download"></i>
              </a>
              <a
                href="https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-X64-macOS"
                class="download-option"
              >
                <div class="arch">
                  <span>x86-64 (Intel/AMD)</span>
                </div>
                <i class="fa-solid fa-download"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="download-info">
          <i class="fa-solid fa-circle-info"></i>
          <p>
            <strong>Note:</strong> Official x86-64 builds target x86-64
            microarchitecture Level 3 (circa 2013). If your CPU predates these
            features, you can still compile Pumpkin from source without them.
          </p>
        </div>

        <p class="download-note">
          Need older versions? Check
          <a
            href="https://github.com/Pumpkin-MC/Pumpkin/releases"
            target="_blank"
            rel="noopener"
            >GitHub Releases</a
          >.
        </p>
      </section>

      <!-- Quick Start -->
      <section class="quickstart">
        <div class="quickstart-content">
          <div class="quickstart-text">
            <h2>Get Started in Seconds</h2>
            <p>
              Download the executable, double-click, and your server is running.
              Check the docs for configuration options.
            </p>
            <div class="quickstart-buttons">
              <a href="https://docs.pumpkinmc.org/" class="btn btn-primary">
                Quick Start Guide <i class="fa-solid fa-arrow-right"></i>
              </a>
              <a
                href="https://discord.com/invite/wT8XjrjKkf"
                class="btn btn-secondary"
              >
                <i class="fab fa-discord"></i> Get Help
              </a>
            </div>
          </div>
          <div class="quickstart-visual">
            <div class="terminal">
              <div class="terminal-header">
                <span class="terminal-dot red"></span>
                <span class="terminal-dot yellow"></span>
                <span class="terminal-dot green"></span>
              </div>
              <div class="terminal-body">
                <div class="terminal-line">
                  <span class="prompt">$</span> ./pumpkin
                </div>
                <div class="terminal-line">
                  <span class="success">[INFO]</span> Starting Pumpkin server...
                </div>
                <div class="terminal-line">
                  <span class="success">[INFO]</span> Server started in
                  <span class="highlight">5ms</span>
                </div>
                <div class="terminal-line">
                  <span class="success">[INFO]</span> Listening on 0.0.0.0:25565
                </div>
                <div class="terminal-line">
                  <span class="success">[INFO]</span> Ready for connections!
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-main">
        <div class="footer-brand">
          <img src="../assets/icon.svg" alt="Pumpkin" />
          <span>pumpkin</span>
        </div>
        <div class="footer-links">
          <a href="https://docs.pumpkinmc.org/">Documentation</a>
          <a href="https://github.com/Pumpkin-MC">GitHub</a>
          <a href="https://discord.com/invite/wT8XjrjKkf">Discord</a>
          <a href="https://github.com/sponsors/Snowiiii">Sponsor</a>
        </div>
      </div>
      <div class="footer-bottom">Made with ❤️ by <a href="https://marshall.dev" target="_blank" rel="noopener">purdze</a></div>
    </footer>
    <script>
      (function () {
        const downloads = {
          windows: {
            x64: "https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-X64-Windows.exe",
            arm64:
              "https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-ARM64-Windows.exe",
          },
          mac: {
            x64: "https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-X64-macOS",
            arm64:
              "https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-ARM64-macOS",
          },
          linux: {
            x64: "https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-X64-Linux",
            arm64:
              "https://github.com/Pumpkin-MC/Pumpkin/releases/download/nightly/pumpkin-ARM64-Linux",
          },
        };

        const btn = document.getElementById("auto-download-btn");
        const icon = document.getElementById("auto-download-icon");
        const text = document.getElementById("auto-download-text");
        const arch = document.getElementById("auto-download-arch");

        const ua = navigator.userAgent.toLowerCase();
        const platform = navigator.platform.toLowerCase();

        let os = "windows";
        let osName = "Windows";
        let iconClass = "fab fa-windows";
        let architecture = "x64";
        let archLabel = "x86-64";

        // Detect OS
        if (ua.includes("mac") || platform.includes("mac")) {
          os = "mac";
          osName = "macOS";
          iconClass = "fab fa-apple";
        } else if (ua.includes("linux") || platform.includes("linux")) {
          os = "linux";
          osName = "Linux";
          iconClass = "fab fa-linux";
        }

        // Detect architecture
        if (
          ua.includes("arm64") ||
          ua.includes("aarch64") ||
          platform.includes("arm") ||
          (navigator.userAgentData &&
            navigator.userAgentData.architecture === "arm")
        ) {
          architecture = "arm64";
          archLabel = "ARM64";
        }

        // Special case: Apple Silicon detection
        if (os === "mac") {
          // Check for Apple Silicon
          const isAppleSilicon = (function () {
            try {
              const canvas = document.createElement("canvas");
              const gl = canvas.getContext("webgl");
              const debugInfo = gl.getExtension("WEBGL_debug_renderer_info");
              const renderer = gl.getParameter(
                debugInfo.UNMASKED_RENDERER_WEBGL,
              );
              return renderer.includes("Apple") && !renderer.includes("Intel");
            } catch (e) {
              return (
                window.navigator.userAgent.includes("Mac") &&
                !window.navigator.userAgent.includes("Intel")
              );
            }
          })();

          if (isAppleSilicon) {
            architecture = "arm64";
            archLabel = "ARM64 (Apple Silicon)";
          }
        }

        // Update button
        btn.href = downloads[os][architecture];
        icon.className = iconClass;
        text.textContent = "Download for " + osName;
        arch.textContent = archLabel;

        // Fetch latest build info
        const buildEl = document.getElementById("auto-download-build");
        const CACHE_KEY = "pumpkin_commit";
        const CACHE_TTL = 60 * 60 * 1000; // 1 hour

        function getCached(key) {
          try {
            const raw = localStorage.getItem(key);
            if (!raw) return null;
            const cached = JSON.parse(raw);
            if (Date.now() - cached.ts > CACHE_TTL) {
              localStorage.removeItem(key);
              return null;
            }
            return cached.data;
          } catch {
            return null;
          }
        }

        function setCache(key, data) {
          try {
            localStorage.setItem(key, JSON.stringify({ ts: Date.now(), data: data }));
          } catch { /* storage full or unavailable */ }
        }

        function timeAgo(date) {
          const seconds = Math.floor((new Date() - date) / 1000);
          const intervals = [
            { label: "year", seconds: 31536000 },
            { label: "month", seconds: 2592000 },
            { label: "day", seconds: 86400 },
            { label: "hour", seconds: 3600 },
            { label: "minute", seconds: 60 },
          ];
          for (const interval of intervals) {
            const count = Math.floor(seconds / interval.seconds);
            if (count >= 1) {
              return (
                count + " " + interval.label + (count > 1 ? "s" : "") + " ago"
              );
            }
          }
          return "just now";
        }

        function renderCommit(data) {
          if (data.sha && data.commit && data.commit.committer.date) {
            const commitDate = new Date(data.commit.committer.date);
            const safeSha = String(data.sha).replace(/[^a-f0-9]/gi, "");
            const commitShort = safeSha.substring(0, 7);
            buildEl.textContent = "Latest commit: " + timeAgo(commitDate) + " \u2022 ";
            const commitLink = document.createElement("a");
            commitLink.href = "https://github.com/Pumpkin-MC/Pumpkin/commit/" + safeSha;
            commitLink.target = "_blank";
            commitLink.rel = "noopener";
            commitLink.textContent = commitShort;
            buildEl.appendChild(commitLink);
          } else {
            buildEl.textContent = "Nightly Build";
          }
        }

        const cached = getCached(CACHE_KEY);
        if (cached) {
          renderCommit(cached);
        } else {
          fetch("https://api.github.com/repos/Pumpkin-MC/Pumpkin/commits/master")
            .then((res) => {
              if (res.status === 403) throw new Error("Rate limited");
              return res.json();
            })
            .then((data) => {
              setCache(CACHE_KEY, { sha: data.sha, commit: data.commit });
              renderCommit(data);
            })
            .catch(() => {
              buildEl.textContent = "Nightly Build";
            });
        }
      })();
    </script>
  </body>
</html>
