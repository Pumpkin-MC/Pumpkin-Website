<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' https://avatars.githubusercontent.com data:; connect-src 'self' https://api.github.com https://www.google-analytics.com; frame-ancestors 'none'"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()" />
    <title>Contributors - Pumpkin</title>
    <meta
      name="description"
      content="Meet the amazing people who contribute to Pumpkin, the fastest Minecraft server."
    />
    <meta property="og:title" content="Contributors - Pumpkin" />
    <meta property="og:description" content="Meet the amazing people who contribute to Pumpkin, the fastest Minecraft server." />
    <meta property="og:image" content="https://pumpkinmc.org/assets/logos/ogimage.png" />
    <meta property="og:url" content="https://pumpkinmc.org/contributors/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="icon" type="image/svg+xml" href="../assets/icon.svg" />
    <link rel="stylesheet" href="../style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha384-rWj9FmWWt3OMqd9vBkWRhFavvVUYalYqGPoMdL1brs/qvvqz88gvLShYa4hKNyqb"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <header>
      <a href="/" class="logo">
        <img src="../assets/icon.svg" alt="Pumpkin" />
        <span>pumpkin</span>
      </a>
      <nav>
        <a href="/">Home</a>
        <a href="https://docs.pumpkinmc.org/">Docs</a>
        <a href="/developers/">Developers</a>
        <a href="/contributors/">Contributors</a>
      </nav>
      <div class="header-icons">
        <a
          href="https://github.com/Pumpkin-MC/Pumpkin"
          class="icon-btn"
          title="GitHub"
        >
          <i class="fa-brands fa-github"></i>
        </a>
        <a
          href="https://discord.com/invite/wT8XjrjKkf"
          class="icon-btn"
          title="Discord"
        >
          <i class="fa-brands fa-discord"></i>
        </a>
        <a
          href="https://github.com/sponsors/Snowiiii"
          class="sponsor-btn"
          title="Sponsor"
        >
          <i class="fa-solid fa-heart"></i>
        </a>
        <a href="/download/" class="download-btn">Download</a>
      </div>
    </header>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-QK7NXQQ2ZP"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-QK7NXQQ2ZP");
    </script>

    <main>
      <section class="contributors-hero">
        <h1 class="section-title">
          Meet our <span class="highlight">Contributors</span>
        </h1>
        <p>
          Pumpkin is built by an amazing community of open source contributors.
        </p>
        <div class="contributor-stats">
          <div class="stat-box">
            <span class="stat-num" id="total-contributors">-</span>
            <span class="stat-label">Contributors</span>
          </div>
          <div class="stat-box">
            <span class="stat-num" id="total-commits">-</span>
            <span class="stat-label">Commits</span>
          </div>
        </div>
      </section>

      <section class="sponsors-section">
        <h2 class="section-subtitle">
          <i class="fa-solid fa-heart"></i> Sponsors
        </h2>
        <p class="sponsors-desc">
          These amazing people help fund Pumpkin's development.
        </p>

        <div class="sponsor-tabs">
          <button class="sponsor-tab active" data-tab="current">Current</button>
          <button class="sponsor-tab" data-tab="past">Past</button>
        </div>

        <div class="sponsors-grid" id="sponsors-current">
          <a
            href="https://github.com/BE-CH"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/1050050?s=60"
              alt="BE-CH"
            />
            <span>BE-CH</span>
          </a>
          <a
            href="https://github.com/illyrius666"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/28700752?s=60"
              alt="illyrius666"
            />
            <span>illyrius666</span>
          </a>
          <a
            href="https://github.com/Pookachu"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/30243655?s=60"
              alt="Pookachu"
            />
            <span>Pookachu</span>
          </a>
          <a
            href="https://github.com/snarkyalyx"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/57874862?s=60"
              alt="snarkyalyx"
            />
            <span>snarkyalyx</span>
          </a>
          <a
            href="https://github.com/ItzCelyrian"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/75842182?s=60"
              alt="ItzCelyrian"
            />
            <span>ItzCelyrian</span>
          </a>
          <a
            href="https://github.com/alexanderstdev"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/75969899?s=60"
              alt="alexanderstdev"
            />
            <span>alexanderstdev</span>
          </a>
          <a
            href="https://github.com/Schweeeeeeeeeeeeeeee"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/88291316?s=60"
              alt="Schweeeeeeeeeeeeeeee"
            />
            <span>Schweeeeeeeeeeeeeeee</span>
          </a>
          <a
            href="https://github.com/ThatOneToast"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/101076597?s=60"
              alt="ThatOneToast"
            />
            <span>ThatOneToast</span>
          </a>
          <a
            href="https://github.com/Priveetee"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/138765817?s=60"
              alt="Priveetee"
            />
            <span>Priveetee</span>
          </a>
          <a
            href="https://github.com/GodData001"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/163206061?s=60"
              alt="GodData001"
            />
            <span>GodData001</span>
          </a>
          <a
            href="https://github.com/FoxMonX"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/191814077?s=60"
              alt="FoxMonX"
            />
            <span>FoxMonX</span>
          </a>
          <a
            href="https://github.com/miutonic"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/249585788?s=60"
              alt="miutonic"
            />
            <span>miutonic</span>
          </a>
          <a
            href="https://github.com/sponsors/Snowiiii"
            class="sponsor-card become-sponsor"
          >
            <i class="fa-solid fa-plus"></i>
            <span>Become a Sponsor</span>
          </a>
        </div>

        <div class="sponsors-grid hidden" id="sponsors-past">
          <a
            href="https://github.com/codabrink"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/779390?s=60"
              alt="codabrink"
            />
            <span>codabrink</span>
          </a>
          <a
            href="https://github.com/charlesvien"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/5378415?s=60"
              alt="charlesvien"
            />
            <span>charlesvien</span>
          </a>
          <a
            href="https://github.com/lzm0"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/7163127?s=60"
              alt="lzm0"
            />
            <span>lzm0</span>
          </a>
          <a
            href="https://github.com/Vianpyro"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/10519369?s=60"
              alt="Vianpyro"
            />
            <span>Vianpyro</span>
          </a>
          <a
            href="https://github.com/ForceGamer"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/10726334?s=60"
              alt="ForceGamer"
            />
            <span>ForceGamer</span>
          </a>
          <a
            href="https://github.com/robke96"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/17088756?s=60"
              alt="robke96"
            />
            <span>robke96</span>
          </a>
          <a
            href="https://github.com/Siydge"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/53163523?s=60"
              alt="Siydge"
            />
            <span>Siydge</span>
          </a>
          <a
            href="https://github.com/Wuemeli"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/54443643?s=60"
              alt="Wuemeli"
            />
            <span>Wuemeli</span>
          </a>
          <a
            href="https://github.com/Unoqwy"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/65187632?s=60"
              alt="Unoqwy"
            />
            <span>Unoqwy</span>
          </a>
          <a
            href="https://github.com/vyPal"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/66716025?s=60"
              alt="vyPal"
            />
            <span>vyPal</span>
          </a>
          <a
            href="https://github.com/nelsonGX"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/68144494?s=60"
              alt="nelsonGX"
            />
            <span>nelsonGX</span>
          </a>
          <a
            href="https://github.com/Legonois"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/74224353?s=60"
              alt="Legonois"
            />
            <span>Legonois</span>
          </a>
          <a
            href="https://github.com/Sweattypalms"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/100982104?s=60"
              alt="Sweattypalms"
            />
            <span>Sweattypalms</span>
          </a>
          <a
            href="https://github.com/strauw-berry"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/101355521?s=60"
              alt="strauw-berry"
            />
            <span>strauw-berry</span>
          </a>
          <a
            href="https://github.com/Game-Host-Bros"
            class="sponsor-card"
            target="_blank"
            rel="noopener"
          >
            <img
              src="https://avatars.githubusercontent.com/u/124571489?s=60"
              alt="Game-Host-Bros"
            />
            <span>Game-Host-Bros</span>
          </a>
          <div class="sponsor-card private-sponsor">
            <i class="fa-solid fa-user-secret"></i>
            <span>Private Sponsor</span>
          </div>
          <div class="sponsor-card private-sponsor">
            <i class="fa-solid fa-user-secret"></i>
            <span>Private Sponsor</span>
          </div>
          <div class="sponsor-card private-sponsor">
            <i class="fa-solid fa-user-secret"></i>
            <span>Private Sponsor</span>
          </div>
        </div>
      </section>

      <section class="contributors-section">
        <h2 class="section-subtitle">
          <i class="fa-solid fa-code"></i> Contributors
        </h2>
        <div class="contributors-grid" id="contributors-grid">
          <div class="loading-state">
            <i class="fa-solid fa-spinner fa-spin"></i>
            <span>Loading contributors...</span>
          </div>
        </div>
        <button
          class="btn btn-secondary show-more-btn"
          id="show-more-btn"
          style="display: none"
        >
          Show More <i class="fa-solid fa-chevron-down"></i>
        </button>
      </section>

      <section class="cta">
        <div class="cta-card">
          <h2>Want to contribute?</h2>
          <p>
            Join our community and help build the fastest Minecraft server ever.
          </p>
          <div class="cta-buttons">
            <a
              href="https://github.com/Pumpkin-MC/Pumpkin"
              class="btn btn-primary btn-large"
            >
              <i class="fa-brands fa-github"></i> View on GitHub
            </a>
            <a
              href="https://discord.com/invite/wT8XjrjKkf"
              class="btn btn-secondary btn-large"
            >
              <i class="fa-brands fa-discord"></i> Join Discord
            </a>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-main">
        <div class="footer-brand">
          <img src="../assets/icon.svg" alt="Pumpkin" />
          <span>pumpkin</span>
        </div>
        <div class="footer-links">
          <a href="https://docs.pumpkinmc.org/">Documentation</a>
          <a href="https://github.com/Pumpkin-MC">GitHub</a>
          <a href="https://discord.com/invite/wT8XjrjKkf">Discord</a>
          <a href="https://github.com/sponsors/Snowiiii">Sponsor</a>
        </div>
      </div>
      <div class="footer-bottom">Made with ❤️ by <a href="https://marshall.dev" target="_blank" rel="noopener">purdze</a></div>
    </footer>

    <script>
      const GITHUB_REPO = "Pumpkin-MC/Pumpkin";
      const COLORS = ["orange", "blue", "green", "purple", "pink", "yellow"];
      const MOBILE_BREAKPOINT = 768;
      const CONTRIBUTORS_PER_PAGE = 10;
      const CACHE_KEY = "pumpkin_contributors";
      const CACHE_TTL = 60 * 60 * 1000; // 1 hour
      let allContributorsData = [];
      let visibleCount = CONTRIBUTORS_PER_PAGE;

      function getCached(key) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return null;
          const cached = JSON.parse(raw);
          if (Date.now() - cached.ts > CACHE_TTL) {
            localStorage.removeItem(key);
            return null;
          }
          return cached.data;
        } catch {
          return null;
        }
      }

      function setCache(key, data) {
        try {
          localStorage.setItem(key, JSON.stringify({ ts: Date.now(), data: data }));
        } catch { /* storage full or unavailable */ }
      }

      // Count up animation - linear 3 seconds
      function countUp(element, target) {
        const duration = 3000;
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          const current = Math.floor(target * progress);
          element.textContent = current.toLocaleString();

          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            element.textContent = target.toLocaleString();
          }
        }

        requestAnimationFrame(update);
      }

      async function fetchContributors() {
        const grid = document.getElementById("contributors-grid");
        const totalContributorsEl =
          document.getElementById("total-contributors");
        const totalCommitsEl = document.getElementById("total-commits");

        // Show loading state with 0
        totalContributorsEl.textContent = "0";
        totalCommitsEl.textContent = "0";

        try {
          let allContributors = getCached(CACHE_KEY);

          if (!allContributors) {
            // Fetch all contributors (paginated)
            allContributors = [];
            let page = 1;
            let hasMore = true;

            while (hasMore) {
              const response = await fetch(
                `https://api.github.com/repos/${GITHUB_REPO}/contributors?per_page=100&page=${page}`,
              );

              if (response.status === 403) {
                const resetHeader = response.headers.get("X-RateLimit-Reset");
                const resetTime = resetHeader
                  ? new Date(Number(resetHeader) * 1000).toLocaleTimeString()
                  : "soon";
                throw new Error("RATE_LIMIT:" + resetTime);
              }
              if (!response.ok) throw new Error("Failed to fetch contributors");

              const contributors = await response.json();
              if (contributors.length === 0) {
                hasMore = false;
              } else {
                allContributors = allContributors.concat(contributors);
                page++;
              }
            }

            // Filter out bots
            allContributors = allContributors.filter((c) => c.type !== "Bot");

            // Cache the result
            setCache(CACHE_KEY, allContributors);
          }

          // Calculate total commits
          const totalCommits = allContributors.reduce(
            (sum, c) => sum + c.contributions,
            0,
          );

          // Animate stats counting up
          countUp(totalContributorsEl, allContributors.length, 1200);
          countUp(totalCommitsEl, totalCommits, 1800);

          // Store contributors data globally
          allContributorsData = allContributors;

          // Render contributors
          renderContributors();
        } catch (error) {
          grid.innerHTML = "";
          const errorDiv = document.createElement("div");
          errorDiv.className = "error-state";
          const errorIcon = document.createElement("i");
          errorIcon.className = "fa-solid fa-exclamation-triangle";
          const errorText = document.createElement("span");
          const errMsg = String(error.message || "");
          if (errMsg.startsWith("RATE_LIMIT:")) {
            const resetTime = errMsg.split(":")[1];
            errorText.textContent =
              "GitHub API rate limit reached. Resets at " + resetTime + ". Please try again later.";
          } else {
            errorText.textContent = "Failed to load contributors. Please try again later.";
          }
          const errorLink = document.createElement("a");
          errorLink.href = "https://github.com/Pumpkin-MC/Pumpkin/graphs/contributors";
          errorLink.className = "btn btn-secondary";
          errorLink.style.marginTop = "1rem";
          errorLink.textContent = "View on GitHub";
          errorDiv.appendChild(errorIcon);
          errorDiv.appendChild(errorText);
          errorDiv.appendChild(errorLink);
          grid.appendChild(errorDiv);
        }
      }

      function isMobile() {
        return window.innerWidth <= MOBILE_BREAKPOINT;
      }

      function isValidGitHubUrl(url) {
        try {
          const parsed = new URL(url);
          return (
            parsed.protocol === "https:" &&
            parsed.hostname === "github.com"
          );
        } catch {
          return false;
        }
      }

      function isValidAvatarUrl(url) {
        try {
          const parsed = new URL(url);
          return (
            parsed.protocol === "https:" &&
            parsed.hostname === "avatars.githubusercontent.com"
          );
        } catch {
          return false;
        }
      }

      function createContributorCard(contributor, index) {
        const color = COLORS[index % COLORS.length];

        const link = document.createElement("a");
        if (isValidGitHubUrl(contributor.html_url)) {
          link.href = contributor.html_url;
        } else {
          link.href = "#";
        }
        link.target = "_blank";
        link.rel = "noopener";
        link.className = "contributor-card color-" + color;

        const img = document.createElement("img");
        if (isValidAvatarUrl(contributor.avatar_url)) {
          img.src = contributor.avatar_url;
        }
        img.alt = String(contributor.login).replace(/[^a-zA-Z0-9_\-]/g, "");
        img.className = "contributor-avatar";

        const info = document.createElement("div");
        info.className = "contributor-info";

        const name = document.createElement("span");
        name.className = "contributor-name";
        name.textContent = contributor.login;

        const commits = document.createElement("span");
        commits.className = "contributor-commits";
        commits.textContent = Number(contributor.contributions) + " commits";

        const icon = document.createElement("i");
        icon.className = "fa-brands fa-github contributor-link";

        info.appendChild(name);
        info.appendChild(commits);
        link.appendChild(img);
        link.appendChild(info);
        link.appendChild(icon);

        return link;
      }

      function renderContributors() {
        const grid = document.getElementById("contributors-grid");
        const showMoreBtn = document.getElementById("show-more-btn");

        const contributorsToShow = isMobile()
          ? allContributorsData.slice(0, visibleCount)
          : allContributorsData;

        grid.innerHTML = "";
        contributorsToShow.forEach((contributor, index) => {
          grid.appendChild(createContributorCard(contributor, index));
        });

        // Show/hide the "Show More" button
        if (isMobile() && visibleCount < allContributorsData.length) {
          showMoreBtn.style.display = "flex";
          const remaining = allContributorsData.length - visibleCount;
          showMoreBtn.textContent = "";
          showMoreBtn.textContent = "Show More (" + remaining + " remaining) ";
          const chevron = document.createElement("i");
          chevron.className = "fa-solid fa-chevron-down";
          showMoreBtn.appendChild(chevron);
        } else {
          showMoreBtn.style.display = "none";
        }
      }

      function showMore() {
        visibleCount += CONTRIBUTORS_PER_PAGE;
        renderContributors();
      }

      // Show more button click handler
      document
        .getElementById("show-more-btn")
        .addEventListener("click", showMore);

      // Re-render on resize (in case switching between mobile/desktop)
      window.addEventListener("resize", () => {
        if (allContributorsData.length > 0) {
          renderContributors();
        }
      });

      fetchContributors();

      // Sponsor tabs
      document.querySelectorAll(".sponsor-tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          const targetTab = tab.dataset.tab;

          // Update active tab
          document
            .querySelectorAll(".sponsor-tab")
            .forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          // Show/hide grids
          document
            .getElementById("sponsors-current")
            .classList.toggle("hidden", targetTab !== "current");
          document
            .getElementById("sponsors-past")
            .classList.toggle("hidden", targetTab !== "past");
        });
      });
    </script>
  </body>
</html>
